import React, { useState, useEffect } from 'react';
import { View, Text, Button, StyleSheet, ActivityIndicator } from 'react-native';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';

// Sua chave da API OpenWeather (substitua pela sua)
const API_KEY = 'a8afb2cd85fca25cebb4fedca70a461b';

// Função para buscar o clima
const fetchWeather = async (setWeatherData) => {
  try {
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?q=São Paulo&appid=${a8afb2cd85fca25cebb4fedca70a461b}&units=metric&lang=pt_br`
    );
    const data = await response.json();
    setWeatherData(data);
  } catch (error) {
    console.error("Erro ao buscar dados do clima:", error);
  }
};

function HomeScreen({ navigation }) {
  const [weatherData, setWeatherData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchWeather(setWeatherData).then(() => setLoading(false));
  }, []);

  if (loading) {
    return (
      <View style={styles.container}>
        <ActivityIndicator size="large" color="#FFC0CB" />
        <Text style={styles.title}>Carregando clima...</Text>
      </View>
    );
  }

  const temperature = weatherData?.main?.temp;
  const description = weatherData?.weather[0]?.description;

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Clima Atual</Text>
      <Text style={styles.temp}>{temperature}°C</Text>
      <Text style={styles.description}>{description}</Text>
      <Button title="Ver Detalhes" onPress={() => navigation.navigate('Detalhes do Clima', { weatherData })} />
      <Button title="Ir para Mapa" onPress={() => navigation.navigate('Mapa')} />
      <Button title="Configurações" onPress={() => navigation.navigate('Configurações')} />
    </View>
  );
}

function WeatherDetailScreen({ route, navigation }) {
  const { weatherData } = route.params;

  const temperature = weatherData?.main?.temp;
  const humidity = weatherData?.main?.humidity;
  const windSpeed = weatherData?.wind?.speed;

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Detalhes do Clima</Text>
      <Text style={styles.detail}>Temperatura: {temperature}°C</Text>
      <Text style={styles.detail}>Umidade: {humidity}%</Text>
      <Text style={styles.detail}>Vento: {windSpeed} km/h</Text>
      <Button title="Voltar para Home" onPress={() => navigation.goBack()} />
    </View>
  );
}

function MapScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>Mapa de Previsão do Tempo</Text>
      <Text style={styles.detail}>Aqui você verá o mapa.</Text>
      <Button title="Voltar para Home" onPress={() => navigation.goBack()} />
    </View>
  );
}

function SettingsScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>Configurações</Text>
      <Text style={styles.detail}>Escolha suas preferências de clima.</Text>
      <Button title="Voltar para Home" onPress={() => navigation.goBack()} />
    </View>
  );
}

// Stack Navigator
const Stack = createStackNavigator();

export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator screenOptions={{ headerStyle: { backgroundColor: '#FFC0CB' } }}>
        <Stack.Screen name="Home" component={HomeScreen} />
        <Stack.Screen name="Detalhes do Clima" component={WeatherDetailScreen} />
        <Stack.Screen name="Mapa" component={MapScreen} />
        <Stack.Screen name="Configurações" component={SettingsScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

// Estilos
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#F5F5DC',
    alignItems: 'center',
    justifyContent: 'center',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#FFC0CB',
  },
  temp: {
    fontSize: 32,
    color: '#FFC0CB',
    marginVertical: 20,
  },
  description: {
    fontSize: 18,
    color: '#FFC0CB',
    marginVertical: 10,
  },
  detail: {
    fontSize: 18,
    color: '#FFC0CB',
    marginVertical: 10,
  },
});
